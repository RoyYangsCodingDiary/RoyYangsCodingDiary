### Sample Output

#
## 9/6/2023
#
#SPX: 4490.35
#DJI: 34611.68
#NASDAQ: 13988.8
#Russell 2000: 1880.74
#S&P/TSX: 20375.14
#FTSE 100: 7437.93
#Euro Stoxx 50 Eur: 4239.35
#Shanghai Composite Index: 3152.2
#Hang Seng Index: 18437.48
#Nikkei 225: 33118.55
#VIX: 14.27
#STOXX 50 Volatility Eur: 16.80
#US Dollar Index: 104.88
#USD/CAD: 1.3635
#EUR/USD: 1.0726
#USD/CNY: 7.3155
#USD/JPY: 147.606
#GBP/USD: 1.2505
#SOFR: 5.31%
# 
#Headline CPI at 304.348 as of Jul 2023
#Core CPI at 308.801 as of Jul 2023
#Fed Funds at 5.33 as of Aug 2023
#Unemp. Rate at 3.8 as of Aug 2023
# 
#US 1 Month Yield: 5.37%
#US 3 Month Yield: 5.47%
#US 6 Month Yield: 5.54%
#US 1 Year Yield: 5.43%
#US 2 Year Yield: 5.01%
#US 3 Year Yield: 4.73%
#US 5 Year Yield: 4.42%
#US 7 Year Yield: 4.38%
#US 10 Year Yield: 4.29%
#US 30 Year Yield: 4.36%
# 
#Gold Spot:	$1,917.85, 0.06% from last close $1,916.61
#Palladium:	$1,216.00, 0.29% from last close $1,212.50
#Platinum Spot:	$915.50, 0.22% from last close $913.50
#Silver Spot:	$23.12, -0.39% from last close $23.21
#Natural Gas (Henry Hub):	$2.51, -0.4% from last close $2.51
#Heating Oil:	$84.80, 0.63% from last close $84.27
#Oil (Brent):	$90.88, 0.28% from last close $90.60
#Oil (WTI):	$87.72, 0.16% from last close $87.54
#Aluminium:	$2,193.44, -0.03% from last close $2,193.44
#Lead Spot:	$2,299.20, 1.14% from last close $2,299.20
#Nickel Spot:	$20,525.00, -1.32% from last close $20,525.00
#Zinc Spot:	$2,435.50, -0.81% from last close $2,435.50
#Cotton Spot:	$0.86, -2.7% from last close $0.86
#Oats Spot:	$4.91, 0.2% from last close $4.75
#Coffee Spot:	$1.53, 0.93% from last close $1.52
#Cocoa Spot:	$2,966.00, 0.92% from last close $2,964.00
#Lean Hog Spot:	$0.82, -1.35% from last close $0.82
#Corn Spot:	$4.71, -0.16% from last close $4.72
#Feeder Cattle:	$2.53, 0.81% from last close $2.53
#Milk Spot:	$18.53, 0.0% from last close $18.51
#Orange Juice:	$3.50, 5.74% from last close $3.46
#Soybeans Spot:	$13.60, 0.39% from last close $13.60
#Wheat Spot:	$215.75, -0.69% from last close $215.50
#Sugar Spot:	$0.26, -1.47% from last close $0.26
# 
#### Holidays
#No market holidays today
#
#### Speeches
#German Buba Wuermeling Speaks at 06:05
#ECB McCaul Speaks at 08:00
#Fed Collins Speaks at 08:30
#German Buba Wuermeling Speaks at 09:35
#BoC Rate Statement at 10:00
#German Buba Balz Speaks at 12:00
#Fed Logan Speaks at 15:00
#BoJ Board Member Nakagawa Speaks at 21:30
#
#### Economic Releases Today
# 02:00 EUR: German Factory Orders (MoM) (Jul) at -11.7%, down from previous 7.6%, below consensus of -4.0%
#03:30 EUR: HCOB Italy Construction PMI (MoM) (Aug) at 47.7, down from previous 48.0
#03:30 EUR: HCOB Germany Construction PMI (Aug) at 41.5, up from previous 41.0
#03:30 EUR: HCOB France Construction PMI (MoM) (Aug) at 42.4, down from previous 42.9
#03:30 EUR: HCOB Eurozone Construction PMI (MoM) (Aug) at 43.4, down from previous 43.5
#05:00 EUR: Retail Sales (YoY) (Jul) at -1.0%, same from previous -1.0%, above consensus of -1.2%
#05:00 EUR: Retail Sales (MoM) (Jul) at -0.2%, down from previous 0.2%, below consensus of -0.1%
#05:30 EUR: German 10-Year Bund Auction at 2.630%, up from previous 2.460%
#07:00 USD: MBA 30-Year Mortgage Rate at 7.21%, down from previous 7.31%
#07:00 USD: MBA Mortgage Applications (WoW) at -2.9%, down from previous 2.3%
#07:00 USD: MBA Purchase Index at 141.9, down from previous 144.9
#07:00 USD: Mortgage Market Index at 183.6, down from previous 189.0
#07:00 USD: Mortgage Refinance Index at 388.1, down from previous 407.1
#07:00 CAD: Leading Index (MoM) (Aug) at 0.05%, up from previous 0.04%
#08:15 CAD: Reserve Assets Total (Aug) at 114.7B, up from previous 114.5B
#08:30 USD: Exports at 251.66B, up from previous 247.50B
#08:30 USD: Imports at 316.70B, up from previous 313.00B
#08:30 USD: Trade Balance (Jul) at -65.00B, down from previous -63.70B, above consensus of -68.00B
#08:30 CAD: Exports (Jul) at 60.42B, up from previous 59.97B
#08:30 CAD: Imports (Jul) at 61.40B, down from previous 64.89B
#08:30 CAD: Labor Productivity (QoQ) (Q2) at -0.6%, up from previous -0.8%, below consensus of -0.1%
#08:30 CAD: Trade Balance (Jul) at -0.99B, up from previous -4.92B, above consensus of -3.65B
#08:55 USD: Redbook (YoY) at 4.1%, down from previous 4.2%
#09:45 USD: S&P Global Composite PMI (Aug) at 50.2, down from previous 52.0, below consensus of 50.4
#09:45 USD: S&P Global Services PMI (Aug) at 50.5, down from previous 52.3, below consensus of 51.0
#10:00 USD: IBD/TIPP Economic Optimism at 43.2, up from previous 40.3, above consensus of 41.1
#10:00 USD: ISM Non-Manufacturing Business Activity (Aug) at 57.3, up from previous 57.1
#10:00 USD: ISM Non-Manufacturing Employment (Aug) at 54.7, up from previous 50.7
#10:00 USD: ISM Non-Manufacturing New Orders (Aug) at 57.5, up from previous 55.0
#10:00 USD: ISM Non-Manufacturing PMI (Aug) at 54.5, up from previous 52.7, above consensus of 52.5
#10:00 USD: ISM Non-Manufacturing Prices (Aug) at 58.9, up from previous 56.8
#10:00 CAD: BoC Interest Rate Decision at 5.00%, same from previous 5.00%, in line with consensus of 5.00%
#16:30 USD: API Weekly Crude Oil Stock at -5.521M, up from previous -11.486M, below consensus of -1.429M
#19:50 JPY: Foreign Bonds Buying at 90.7B, down from previous 425.3B
#19:50 JPY: Foreign Investments in Japanese Stocks at 531.9B, up from previous -603.2B
#19:50 JPY: Foreign Reserves (USD) (Aug) at 1,251.2B, down from previous 1,253.7B
#
#### Upcoming Economic Releases
#23:00 CNY: Exports (Aug) upcoming release, previous figure at -9.20M
#23:00 CNY: Imports (Aug) upcoming release, previous figure at -6.90M
#23:00 CNY: Trade Balance (Aug) upcoming release, previous figure at 575.70M
#23:00 CNY: Exports (YoY) (Aug) upcoming release, previous figure at -14.5%
#23:00 CNY: Imports (YoY) (Aug) upcoming release, previous figure at -12.4%
#23:00 CNY: Trade Balance (USD) (Aug) upcoming release, previous figure at 80.60B
#23:35 JPY: 30-Year JGB Auction upcoming release, previous figure at 1.593% 
# 
#### M&A Activity: 
# 
# 
#### Headlines: 
#
#


### Script
import pandas as pd
import numpy as np
from bs4 import BeautifulSoup
import requests
from urllib.request import Request, urlopen
from urllib.error import URLError, HTTPError
import datetime as dt
import math
import re
import warnings
warnings.simplefilter("ignore")

# Functions
class yahoo:
    def get_open(link):
        with urlopen(Request(url = link, headers={'User-Agent': 'Mozilla/5.0'})) as response:
            webpage = response.read()
        soup = BeautifulSoup(webpage, 'html.parser')
        return float((soup.find('td', attrs={'class': 'Ta(end) Fw(600) Lh(14px)', 'data-test': 'OPEN-value'}).text).replace(",",""))
    def get_current(link):
        with urlopen(Request(url = link, headers={'User-Agent': 'Mozilla/5.0'})) as response:
            webpage = response.read()
        soup = BeautifulSoup(webpage, 'html.parser')
        return float((soup.find('fin-streamer', {'class': 'Fw(b) Fz(36px) Mb(-4px) D(ib)'}).text).replace(",",""))

def get_market_watch_intraday_quote(url):
    with urlopen(Request(url = url, headers={'User-Agent': 'Mozilla/5.0'})) as response:
        webpage = response.read()
    soup = BeautifulSoup(webpage, 'html.parser')
    return "{:.2f}".format(float(soup.find('bg-quote', class_='value').get_text()))

def get_investing_open(url):
    with urlopen(Request(url = url, headers={'User-Agent': 'Mozilla/5.0'})) as response:
        webpage = response.read()
    soup = BeautifulSoup(webpage, 'html.parser')
    return "{:.2f}".format(float(soup.find('span', class_='key-info_dd-numeric__ZQFIs').get_text().replace(",","")))

def get_sofr_rate(url):
    with urlopen(Request(url = url, headers={'User-Agent': 'Mozilla/5.0'})) as response:
        webpage = response.read()
    soup = BeautifulSoup(webpage, 'html.parser')
    cleaned_sofr = float(re.findall(r'[-\d.,]+', soup.find('p', class_='sofrrate').get_text())[0])
    return "{:.2f}%".format(cleaned_sofr)

def write_indicator_commentary(row):
    time = str(row["Time"])
    cur = str(row["Cur"])
    event = str(row["Event"])
    actual = str(row["Actual"])
    if len(re.findall(r'[-\d.,]+', actual)) == 0:
        actual_num = np.nan
    else:
        actual_num = float(re.findall(r'[-\d.,]+', actual)[0].replace(",",""))

    forecast = str(row["Forecast"])
    if len(re.findall(r'[-\d.,]+', forecast)) == 0:
        forecast_num = np.nan
    else:
        forecast_num = float(re.findall(r'[-\d.,]+', forecast)[0].replace(",",""))
        
    previous = str(row["Previous"])
    if len(re.findall(r'[-\d.,]+', previous)) == 0:
        previous_num = np.nan
    else:
        previous_num = float(re.findall(r'[-\d.,]+', previous)[0].replace(",",""))

    if pd.isna(actual_num):
        return f"{time} {cur}: {event} upcoming release, previous figure at {previous}"
    elif pd.isna(previous_num):
        return f"{time} {cur}: {event} upcoming release"
    elif actual_num > previous_num:
        up_or_down = "up"
    elif actual_num < previous_num:
        up_or_down = "down"
    else:
        up_or_down = "same"
        
    if pd.isna(forecast_num):
        return f"{time} {cur}: {event} at {actual}, {up_or_down} from previous {previous}"

    elif actual_num > forecast_num:
        above_or_below = "above"
    elif actual_num < forecast_num:
        above_or_below = "below"
    else:
        above_or_below = "in line with"
    return f"{time} {cur}: {event} at {actual}, {up_or_down} from previous {previous}, {above_or_below} consensus of {forecast}"

def get_indicators_report(link):
    ### Economic Events
    with urlopen(Request(url = link, headers={'User-Agent': 'Mozilla/5.0'})) as response:
            webpage = response.read()
    economic_events = pd.read_html(webpage)[2]
    economic_events.columns = ["Time", "Cur", "Importance", "Event", "Actual", "Forecast", "Previous", "Extra1", "Extra2"]
    economic_events = economic_events.drop(columns=["Extra1", "Extra2"], index=0)
    economic_events = economic_events[economic_events["Cur"].isin(["JPY", "EUR", "CNY", "USD", "CAD"])]

    if len(list(economic_events[economic_events["Importance"] == "Holiday"]["Event"].drop_duplicates())) == 0:
        holidays = "No market holidays today"
    else:
        holidays = "\n".join(list(economic_events[economic_events["Importance"] == "Holiday"]["Event"].drop_duplicates()))

    speeches = economic_events[economic_events[["Actual", "Forecast", "Previous"]].isnull().all(axis=1)][["Time", "Event"]]
    speeches["Final"] = economic_events["Event"].astype(str) + " at " + economic_events["Time"]
    speeches_string = "\n".join(list(speeches["Final"]))

    indicators = economic_events[~((economic_events["Event"].isin(speeches["Event"])) | (economic_events["Event"].isin(economic_events[economic_events["Importance"] == "Holiday"]["Event"].drop_duplicates())))].reset_index(drop=True)
    indicators = indicators.fillna("NA")

    already_released = indicators[indicators["Actual"] != "NA"]
    coming_up = indicators[indicators["Actual"] == "NA"]
    return holidays, speeches_string, already_released, coming_up
    
def get_fred(url):
    with urlopen(Request(url = url, headers={'User-Agent': 'Mozilla/5.0'})) as response:
        webpage = response.read()
    soup = BeautifulSoup(webpage, 'html.parser')
    as_of_date = soup.find('span', {'class': 'series-meta-value'}).text.replace(":","")
    value = soup.find('span', {'class': 'series-meta-observation-value'}).text
    return as_of_date, value

# Yahoo Finance Data
yahoo_data = {
    "SPX":yahoo.get_open("https://ca.finance.yahoo.com/quote/%5EGSPC?p=%5EGSPC"),
    "DJI":yahoo.get_open("https://ca.finance.yahoo.com/quote/%5EDJI?p=%5EDJI"),
    "NASDAQ":yahoo.get_open("https://ca.finance.yahoo.com/quote/%5EIXIC?p=^IXIC&.tsrc=fin-srch"),
    "Russell 2000":yahoo.get_open("https://ca.finance.yahoo.com/quote/%5ERUT?p=%5ERUT"),
    "S&P/TSX":yahoo.get_open("https://ca.finance.yahoo.com/quote/%5EGSPTSE?p=%5EGSPTSE"),
    "FTSE 100":yahoo.get_open("https://ca.finance.yahoo.com/quote/%5EFTSE?p=%5EFTSE"),
    "Euro Stoxx 50 Eur":get_investing_open("https://ca.investing.com/indices/eu-stoxx50"),
    "Shanghai Composite Index":yahoo.get_open("https://finance.yahoo.com/quote/000001.SS"),
    "Hang Seng Index":yahoo.get_open("https://ca.finance.yahoo.com/quote/%5EHSI?p=^HSI&.tsrc=fin-srch"),
    "Nikkei 225":yahoo.get_open("https://ca.finance.yahoo.com/quote/%5EN225?p=%5EN225"),
    "VIX":yahoo.get_open("https://ca.finance.yahoo.com/quote/%5EVIX?p=^VIX&.tsrc=fin-srch"),
    "STOXX 50 Volatility Eur":get_investing_open("https://www.investing.com/indices/stoxx-50-volatility-vstoxx-eur"),
    "US Dollar Index":yahoo.get_open("https://ca.finance.yahoo.com/quote/%5ENYICDX?p=^NYICDX&.tsrc=fin-srch"),
    "USD/CAD":yahoo.get_open("https://ca.finance.yahoo.com/quote/CAD=X?p=CAD=X&.tsrc=fin-srch"),
    "EUR/USD":yahoo.get_open("https://ca.finance.yahoo.com/quote/EURUSD=X?p=EURUSD=X&.tsrc=fin-srch"),
    "USD/CNY":yahoo.get_open("https://ca.finance.yahoo.com/quote/CNY=X?p=CNY=X&.tsrc=fin-srch"),
    "USD/JPY":yahoo.get_open("https://ca.finance.yahoo.com/quote/JPY=X?p=JPY=X&.tsrc=fin-srch"),
    "GBP/USD":yahoo.get_open("https://ca.finance.yahoo.com/quote/GBPUSD=X?p=GBPUSD=X&.tsrc=fin-srch"),
    "SOFR":get_sofr_rate("https://www.sofrrate.com/")
}

us_econ_data = {
    "Headline CPI":"https://fred.stlouisfed.org/series/CPIAUCSL",
    "Core CPI":"https://fred.stlouisfed.org/series/CPILFESL",
    "Fed Funds":"https://fred.stlouisfed.org/series/FEDFUNDS",
    "Unemp. Rate":"https://fred.stlouisfed.org/series/UNRATE"
}
    
# Bond Data
bond_data = {
    "US 1 Month Yield":get_market_watch_intraday_quote("https://www.marketwatch.com/investing/bond/tmubmusd01m?countryCode=BX"),
    "US 3 Month Yield":get_market_watch_intraday_quote("https://www.marketwatch.com/investing/bond/tmubmusd03m?countryCode=BX"),
    "US 6 Month Yield":get_market_watch_intraday_quote("https://www.marketwatch.com/investing/bond/tmubmusd06m?countryCode=BX"),
    "US 1 Year Yield":get_market_watch_intraday_quote("https://www.marketwatch.com/investing/bond/tmubmusd01y?countryCode=BX"),
    "US 2 Year Yield":get_market_watch_intraday_quote("https://www.marketwatch.com/investing/bond/tmubmusd02y?countryCode=BX"),
    "US 3 Year Yield":get_market_watch_intraday_quote("https://www.marketwatch.com/investing/bond/tmubmusd03y?countryCode=BX"),
    "US 5 Year Yield":get_market_watch_intraday_quote("https://www.marketwatch.com/investing/bond/tmubmusd05y?countryCode=BX"),
    "US 7 Year Yield":get_market_watch_intraday_quote("https://www.marketwatch.com/investing/bond/tmubmusd07y?countryCode=BX"),
    "US 10 Year Yield":get_market_watch_intraday_quote("https://www.marketwatch.com/investing/bond/tmubmusd10y?countryCode=BX"),
    "US 30 Year Yield":get_market_watch_intraday_quote("https://www.marketwatch.com/investing/bond/tmubmusd30y?countryCode=BX")
}

# Commodities
commodities_df = pd.read_html("https://markets.businessinsider.com/commodities/realtime-list")[0]
commodities_df = commodities_df.drop(columns=commodities_df.columns[-1])
commodities_df.columns = ["Commodity", "Last", "Previous Close", "%", "Absolute", "Trade Time", "Unit"]
commodities_df = commodities_df.dropna(subset=["Commodity"])
commodities_df = commodities_df.reset_index(drop=True)
commodities_df["Commodity"] = commodities_df["Commodity"].str.replace(" \(Henry Hub\)", "")

### Economic Events
holidays, speeches_string, released_data, upcoming_data = get_indicators_report("https://www.investing.com/economic-calendar/")

released_data["Commentary"] = released_data.apply(write_indicator_commentary, axis=1)
released_data_string = "\n".join(list(released_data["Commentary"]))

upcoming_data["Commentary"] = upcoming_data.apply(write_indicator_commentary, axis=1)
upcoming_data_string = "\n".join(list(upcoming_data["Commentary"]))

# Commentary
today = dt.datetime.today()
text_current = f"\n# {today.month}/{today.day}/{today.year}\n\n"

for key, value in yahoo_data.items():
    text_current = text_current + f"{key}: {value}\n"
    
text_current = text_current + " \n"

for key, value in us_econ_data.items():
    econ_date, econ_value = get_fred(value)
    text_current = text_current + f"{key} at {econ_value} as of {econ_date}\n"
    
text_current = text_current + " \n"

for key, value in bond_data.items():
    text_current = text_current + f"{key}: {value}%\n"
    
text_current = text_current + " \n"

for row in range(commodities_df.shape[0]):
    if len(commodities_df.loc[row, "Commodity"]) < 9:
        commodity = commodities_df.loc[row, "Commodity"] + " Spot"
    else:
        commodity = commodities_df.loc[row, "Commodity"]
    
    last_price = "${:,.2f}".format(commodities_df.loc[row, "Last"])
    previous_close = "${:,.2f}".format(commodities_df.loc[row, "Previous Close"])
    pct = float((commodities_df.loc[row, "%"])[:-1])
    text_current = text_current + f"{commodity}:\t{last_price}, {pct}% from last close {previous_close}\n"
    
text_current = text_current + " \n"

text_current = text_current + f"### Holidays\n{holidays}\n\n### Speeches\n{speeches_string}\n\n### Economic Releases Today\n {released_data_string}\n\n### Upcoming Economic Releases\n{upcoming_data_string}"
                 
text_current = text_current + " \n"
text_current = text_current + " \n"


ma_activity = input("M&A Activity? ")
cleaned_ma_activity = "\n".join([f"- {n}" for n in [ele.strip() for ele in ma_activity.split("-") if ele.strip() != ""]])
text_current = text_current + (f"### M&A Activity: \n {cleaned_ma_activity}\n")

text_current = text_current + " \n"

headlines = input("Headlines? ")
cleaned_headlines = "\n".join([f"- {n}" for n in [ele.strip() for ele in headlines.split("-") if ele.strip() != ""]])
text_current = text_current + (f"### Headlines: \n {cleaned_headlines}")

print("________________________")
print(text_current)
